

---

# **Система аналитики новостей с многослойной визуализацией**

**Версия 2.1**

## **1. Введение**

### **Цель системы**

Создать инструмент, позволяющий:

- Из потока новостей и постов формировать **глубокое аналитическое понимание** событий в любом домене.
    
- Структурировать данные в формате, пригодном для поиска, исследования и прогнозирования.
    
- Обеспечить **визуализацию** связей между событиями, сюжетами, доменами и акторами.
    
- Дать возможность **исследовать** спектр мнений и фактов, их источники и взаимосвязи.
    
- Автоматизировать рутинный сбор и первичную классификацию данных, оставляя за человеком роль редактора и аналитика.
    

### **Ключевые задачи**

1. **Сбор и нормализация данных** — получение материалов из новостных каналов, блогов, официальных источников.
    
2. **Извлечение сущностей** (NER, события, связи) из текстов.
    
3. **Классификация по доменам и сюжетам**.
    
4. **Фильтрация и оценка качества информации** (релевантность, достоверность).
    
5. **Визуализация** в виде графов, таймлайнов и карточек.
    
6. **Взаимосвязь элементов** — от мнений и фактов к сюжетам, от сюжетов к доменам.
    
7. **Поддержка аналитических функций** — прогнозы, выявление трендов, анализ акторов.
    

---

## **2. Сущности и онтология**

Система оперирует ограниченным, но ёмким набором сущностей.  
Ниже — **полный список с определениями и принципами извлечения**.

---

### **2.1. Домен**

**Определение:**  
Тематика верхнего уровня, объединяющая сюжеты и поддомены.  
Может быть геополитической, отраслевой, технологической, социально-культурной и т.п.

**Пример:**

- Геополитика → Военные конфликты → Война в Украине
    
- Технологии → Искусственный интеллект → Мультимодальные модели
    

**Извлечение:**

- Верхний уровень: **полуавтоматически** (система предлагает, редактор утверждает/правит).
    
- Подуровни: **автоматически** на основе кластеризации сюжетов и ключевых слов.
    

**Методы:**

- Тематическое моделирование (LDA, BERTopic).
    
- Семантические эмбеддинги (Sentence-BERT, OpenAI embeddings).
    
- Классификация по готовым рубрикаторам (ONS, IPTC Media Topics).
    

---

### **2.2. Сюжет**

**Определение:**  
Центральная аналитическая единица — связанная группа фактов, мнений и акторов, описывающих развитие конкретного события или цепочки событий.

**Пример:**  
"Поставки F-16 в Украину" — включает:

- Факты: контракты, поставки, заявления политиков.
    
- Мнения: комментарии экспертов, медиа, блогеров.
    
- Акторы: страны, компании, военные альянсы.
    

**Извлечение:**

- Автоматическая группировка сообщений с высокой семантической близостью.
    
- Определение центральной темы (с помощью NER + кластеризации событий).
    
- Постоянное обновление по мере поступления новых данных.
    

**Особенности:**

- Сюжеты могут принадлежать к нескольким доменам.
    
- Сюжеты могут объединяться или дробиться со временем.
    

---

### **2.3. Мнение**

**Определение:**  
Оценочное или интерпретационное высказывание автора относительно сюжета или факта.

**Извлечение:**

- Определение авторства (NER → PER + авторские теги).
    
- Анализ модальности текста (определение субъективности).
    
- Классификация тональности (sentiment analysis).
    

**Отличие от факта:**

- У мнения **всегда** один конкретный автор.
    
- Содержит оценку, прогноз или субъективное утверждение.
    

---

### **2.4. Факт**

**Определение:**  
Событие с подтверждаемым содержанием, временем, местом, участниками.

**Извлечение:**

- Определение временных сущностей (temporal NER).
    
- Геопарсинг для извлечения мест.
    
- Верификация по нескольким источникам.
    

**Отличие от мнения:**

- Может иметь **несколько независимых источников**.
    
- Описывает событие, а не его интерпретацию.
    

---

### **2.5. Актор**

**Определение:**  
Персона, организация, компания, государство или иная именованная сущность, участвующая в сюжете.

**Извлечение:**

- NER с типами PER, ORG, LOC.
    
- Сопоставление с базой известных акторов (Wikidata, внутренние справочники).
    
- Определение роли актора в сюжете (инициатор, участник, объект воздействия).
    

---

### **2.6. Автор**

**Определение:**  
Источник мнения или факта. Может быть человеком, организацией, СМИ, блогом.

**Извлечение:**

- Метаданные поста или статьи.
    
- Сопоставление с базой источников (с указанием доверия к источнику).
    

---

Тогда продолжаем — сейчас дам **секции 3–4** с упором на иерархию доменов и расширенное описание сюжетов.

---

## **3. Иерархия доменов**

### **3.1. Принципы формирования**

- **Верхний уровень** — **полуавтоматический**:
    
    - Система предлагает кластеры тем на основе статистики и семантической близости.
        
    - Редактор утверждает, объединяет или удаляет категории.
        
- **Нижние уровни** — **автоматические**:
    
    - Строятся на основе связей сюжетов и их ключевых понятий.
        
    - Регулярная перекластеризация с учётом новых сюжетов.
        

---

### **3.2. Логическая структура**

1. **Домен верхнего уровня** (например, _Технологии_).
    
2. **Поддомен** (например, _Искусственный интеллект_).
    
3. **Субподдомен** (например, _Мультимодальные модели_).
    
4. **Сюжеты** (например, _Запуск GPT-5_, _Новый рекорд Gemini 2.0_).
    

---

### **3.3. Визуализация**

- В **графовом режиме**:
    
    - Узлы верхнего уровня — крупные окружности.
        
    - Поддомены — более мелкие, связаны дугами.
        
    - Сюжеты — «листья» на концах веток.
        
- В **текстовом режиме**:
    
    - Древовидный список с раскрывающимися ветками.
        
    - Для каждого узла — количество сюжетов и их активность (по цветовой метке).
        

---

### **3.4. Привязка сюжетов к доменам**

- Сюжет может принадлежать **нескольким** доменам и поддоменам.
    
- Вес принадлежности — от 0 до 1 (например, _70% Геополитика, 30% Экономика_).
    
- Автоматическая привязка по эмбеддингам ключевых слов и акторов.
    

---

## **4. Сюжет как центральная единица системы**

### **4.1. Определение**

Сюжет — это **группа связанных событий, мнений и акторов**, описывающих развитие одного сценария. Он — основной фокус работы аналитика и редактора.

---

### **4.2. Как извлекается сюжет**

1. **Сбор кандидатов** — поток новостей сегментируется на смысловые единицы (посты, абзацы).
    
2. **NER и событийный парсинг** — извлекаются акторы, даты, ключевые события.
    
3. **Кластеризация** — материалы группируются по семантической близости.
    
4. **Формирование ядра сюжета** — выбирается центральное событие/тема.
    
5. **Автоматическая генерация карточки**:
    
    - Заголовок.
        
    - Краткое описание (саммари).
        
    - Ключевые факты и мнения.
        
    - Список акторов.
        
6. **Редакторская проверка** — при необходимости сюжет переименовывается, уточняется или объединяется с другим.
    

---

### **4.3. Динамика сюжетов**

- Сюжет **живёт** и **меняется**:
    
    - Новые факты добавляют временные точки на таймлайн.
        
    - Новые мнения расширяют спектр оценок.
        
    - Появление новых акторов может изменить акценты.
        
- Если активность падает — сюжет «уходит» на периферию графа.
    
- Если всплеск упоминаний — сюжет «движется» в центр (как в модели гиперболического диска Пуанкаре).
    

---

### **4.4. Связи сюжетов**

- **По актору**: если два сюжета имеют общих акторов, между ними проводится связь.
    
- **По факту**: один факт может быть частью нескольких сюжетов.
    
- **По времени**: сюжеты, начавшиеся в одном временном окне, могут быть сгруппированы в общий контекст.
    

---

### **4.5. Взаимодействие сюжета с другими сущностями**

- **Факты**: таймлайн сюжета заполняется подтверждёнными событиями.
    
- **Мнения**: отображаются как отдельные точки под временной шкалой, сгруппированные по авторам и источникам.
    
- **Акторы**: карточки акторов содержат все сюжеты, в которых они участвуют.
    
- **Домен**: сюжет наследует теги и категориальную структуру своих доменов.
    

---

отлично, продолжу документ — **секции 5–6**: формальные правила различения «мнения» и «факта» (с формулами и метриками) и большой **пример данных** с UI‑представлением.

---

## **5. «Мнение» vs «Факт»: формальные правила и метрики**

Разграничение между «мнением» и «фактом» — ключевой элемент корректного анализа. Ошибка в классификации приведёт к искажённой аналитике и некорректным прогнозам.

### **5.1. Операционные определения**

**Факт** — утверждение о событии или состоянии, которое можно проверить или подтвердить, содержащее:

- Время начала (и при необходимости — окончания).
    
- Место.
    
- Участников (акторов).
    
- Содержание (что произошло).
    
- Источники подтверждения (не менее одного).
    
- Может иметь несколько независимых источников.
    
- Факт существует независимо от интерпретации.
        
    - Пример: «12 марта 2025 года в 15:00 по киевскому времени произошло землетрясение магнитудой 5,6 в Одессе».
        

**Мнение** — субъективная оценка, интерпретация или комментарий к факту или сюжету:

- Один конкретный автор.
    
- Содержит субъективные формулировки или оценочную лексику.
    
- Может ссылаться на факты, но не является фактом сам по себе.
    
            
    - Пример: «Это землетрясение — следствие незаконных строительных работ на побережье».

Подтипы фактов: событийные, статистические, документированные.  
Подтипы мнений: оценка, прогноз, гипотеза, призыв/рекомендация.

---

### **5.2. Признаки для классификации (извлечение из текста)**

| Признак                             | Факт                                             | Мнение                                                     |
| ----------------------------------- | ------------------------------------------------ | ---------------------------------------------------------- |
| Верифицируемость                    | Да (по док‑там/наблюдениям)                      | Нет напрямую                                               |
| Временная/пространственная привязка | Чёткая (дата/время/место)                        | Может отсутствовать или быть расплывчатой                  |
| Лексика                             | Числа, даты, топонимы, глаголы совершенного вида | Модальные/оценочные слова: «вероятно», «важный», «опасный» |
| Источник                            | Офиц. бюллетень/агентство/документ               | Автор‑комментатор/медиа‑колумнист/блог                     |
| Структура                           | Констатация («что произошло»)                    | Интерпретация/прогноз («что значит/будет»)                 |

Критерии классификации:

| Критерий              | Факт                                     | Мнение                                                         |
| --------------------- | ---------------------------------------- | -------------------------------------------------------------- |
| Авторство             | Может иметь несколько источников         | Один конкретный автор                                          |
| Подтверждаемость      | Проверяется по независимым источникам    | Необязательно подтверждается                                   |
| Эмоциональная окраска | Отсутствует                              | Может быть выражена                                            |
| Временная привязка    | Чёткая, фиксированная                    | Может быть размытой или отсутствовать                          |
| Форма                 | Сообщение о событии                      | Интерпретация, комментарий, прогноз                            |
| Структурные поля      | Время, место, акторы, событие, источники | Автор, текст, ссылка на факт или сюжет                         |
| Роль в аналитике      | Формирует основу сюжета и прогнозов      | Формирует контекст, спектр интерпретаций, тональность дискурса |

Техники:

- NER (дат, мест, акторов), temporal tagging, геопарсинг.
    
- Классификация `modality` (fact/opinion/forecast) на трансформерах.
    
- Маркеры модальности/оценочности (лингвистические признаки).
    

---

### **5.3 Метрика достоверности факта**

Для факта вводится метрика **Credibility_Fact**:

Credibility_Fact=Trust_Sourceavg×CrossRef_FactorCredibility\_Fact = Trust\_Source_{avg} \times CrossRef\_FactorCredibility_Fact=Trust_Sourceavg​×CrossRef_Factor

Где:

- **Trust_Source_avg** — среднее значение доверия к источникам (от 0 до 1).
    
    - Государственное агентство новостей — 0.95–1.0
        
    - Крупное проверенное медиа — 0.8–0.9
        
    - Независимый блог — 0.3–0.6
        
- **CrossRef_Factor** — коэффициент, учитывающий количество независимых подтверждений.
    
    - Формула:
        
        CrossRef_Factor=1−e−k⋅NCrossRef\_Factor = 1 - e^{-k \cdot N}CrossRef_Factor=1−e−k⋅N
        
        где **N** — число подтверждающих источников, **k** — коэффициент насыщения (0.3–0.5).
        

---

### **5.4 Метрика достоверности мнения**

Для мнения вводится метрика **Credibility_Opinion**:

Credibility_Opinion=Trust_Author×Citation_FactorCredibility\_Opinion = Trust\_Author \times Citation\_FactorCredibility_Opinion=Trust_Author×Citation_Factor

Где:

- **Trust_Author** — доверие к конкретному автору (от 0 до 1, можно редактировать вручную в панели администратора).
    
- **Citation_Factor** — коэффициент цитируемости (число ссылок на данное мнение или его ключевые тезисы в других источниках).
    

---

### **5.5 Принципы работы системы**

1. **NER и семантический анализ** выделяют:
    
    - Именованные сущности (имена, организации, локации, даты, события).
        
    - Эмоциональную окраску (Sentiment Analysis).
        
    - Фактуальные утверждения (Fact Extraction).
        
    - Субъективные утверждения (Opinion Mining).
        
2. Каждое утверждение классифицируется:
    
    - Если присутствует подтверждаемое событие + ≥2 источника → факт.
        
    - Если присутствует только один источник и субъективная оценка → мнение.
        
3. Для каждой категории вычисляется метрика достоверности.
    
4. Данные в UI помечаются визуально:
    
    - Факты — строгие рамки, иконка «галочка».
        
    - Мнения — рамка с пунктиром, иконка «речь».

---

### **5.6. Редакторские рычаги и прозрачность**

- Редактор правит **priors** (`trust_base`) у площадок/авторов; система пересчитывает всё автоматически.
    
- Спорные кейсы — «заморозка» до верификации.
    
- В UI: кнопка «почему такой балл?» раскрывает вклад `base/cross_support/conflict` для фактов и `A/C/F` для мнений.

### 5.7. **Использование в UI и аналитике**

- При отображении **фактов** — цветовая градация по FactTrust (от красного — низкая достоверность, до зелёного — высокая).
    
- При отображении **мнений** — прозрачность и размер карточки зависят от OpinionTrust.
    
- В таймлайне можно фильтровать события и мнения по минимальному уровню достоверности.
    
- В аналитических сводках система может отдельно подсчитывать:
    
    - Среднюю достоверность фактов по сюжету.
        
    - Спектр мнений (разброс от положительных до отрицательных относительно центрального факта).    

---

## **6. Пример данных и UI‑сценарий**

### **6.1. Иерархия доменов (верхний и нижний уровни)**

```json
{
  "domains": [
    {
      "domain_id": "politics", "name": "Политика", "level": "L0", "path": "politics",
      "children": [
        {"domain_id": "geopolitics", "name": "Геополитика", "level": "L1", "path": "politics.geopolitics"},
        {"domain_id": "elections", "name": "Выборы", "level": "L1", "path": "politics.elections"}
      ]
    },
    {
      "domain_id": "economy", "name": "Экономика", "level": "L0", "path": "economy",
      "children": [
        {"domain_id": "markets", "name": "Рынки и финансы", "level": "L1", "path": "economy.markets"},
        {"domain_id": "sanctions", "name": "Санкции и торговля", "level": "L1", "path": "economy.sanctions"}
      ]
    },
    {
      "domain_id": "tech", "name": "Технологии", "level": "L0", "path": "tech",
      "children": [
        {"domain_id": "tech_ai", "name": "Искусственный интеллект", "level": "L1", "path": "tech.ai"},
        {"domain_id": "cybersec", "name": "Кибербезопасность", "level": "L1", "path": "tech.cybersec"}
      ]
    },
    {
      "domain_id": "security", "name": "Безопасность", "level": "L0", "path": "security",
      "children": [
        {"domain_id": "war_ukraine", "name": "Война в Украине", "level": "L1", "path": "security.war_ukraine"},
        {"domain_id": "terrorism", "name": "Терроризм", "level": "L1", "path": "security.terrorism"}
      ]
    }
  ]
}
```

> Нижние уровни (L2–L3) система может сгенерировать автоматически из сюжетов; редактор подтверждает/правит.

---

### **6.2. Три примера сюжетов (каждый — в нескольких доменах)**

```json
[
  {
    "story_id": "story_ukraine_aid_q3_2025",
    "title": "Пакеты помощи Украине (Q3 2025)",
    "domains": [
      {"domain_id": "security.war_ukraine", "weight": 0.85},
      {"domain_id": "economy.sanctions", "weight": 0.25},
      {"domain_id": "politics.geopolitics", "weight": 0.20}
    ],
    "importance": 0.81, "novelty_today": 0.37, "credibility": 0.92
  },
  {
    "story_id": "story_ai_race_q3_2025",
    "title": "Гонка LLM (Q3 2025)",
    "domains": [
      {"domain_id": "tech.tech_ai", "weight": 0.90},
      {"domain_id": "economy.markets", "weight": 0.30},
      {"domain_id": "politics.geopolitics", "weight": 0.15}
    ],
    "importance": 0.78, "novelty_today": 0.41, "credibility": 0.88
  },
  {
    "story_id": "story_energy_supply_black_sea",
    "title": "Логистика и энергопоставки в Чёрном море",
    "domains": [
      {"domain_id": "economy.sanctions", "weight": 0.65},
      {"domain_id": "security.war_ukraine", "weight": 0.45}
    ],
    "importance": 0.69, "novelty_today": 0.22, "credibility": 0.86
  }
]
```

---

### **6.3. Расширенный пример одного сюжета (карточка + сущности + таймлайн)**

#### **6.3.1. Карточка сюжета**

```json
{
  "story_id": "story_ukraine_aid_q3_2025",
  "title": "Пакеты помощи Украине (Q3 2025)",
  "abstract": "Серия объявлений о военной и экономической помощи Украине со стороны США и ЕС в июле–сентябре 2025.",
  "timespan": ["2025-07-01T00:00:00Z", null],
  "domains": [
    {"domain_id": "security.war_ukraine", "weight": 0.85},
    {"domain_id": "economy.sanctions", "weight": 0.25},
    {"domain_id": "politics.geopolitics", "weight": 0.20}
  ],
  "importance": 0.81,
  "novelty_today": 0.37,
  "credibility": 0.92,
  "background": "С 2024 года объёмы помощи колебались в зависимости от политических решений США и ЕС.",
  "drivers": ["Эскалация на фронте", "Внутриполитические факторы в США/ЕС", "Производственные возможности ПВО"],
  "implications": ["Усиление ПВО", "Давление на логистику поставок", "Ответные меры РФ"],
  "scenarios": [
    {"label": "Базовый", "description": "Регулярные поставки сохраняются", "probability": 0.60},
    {"label": "Усиление", "description": "Рост помощи и расширение номенклатуры", "probability": 0.25},
    {"label": "Сокращение", "description": "Политические ограничения снижают объём и темп", "probability": 0.15}
  ],
  "linked_stories": [
    {"story_id": "story_energy_supply_black_sea", "relation": "related_to", "strength": 0.55}
  ],
  "centroid_entities": ["ent_US_Gov", "ent_Ukraine", "ent_EU", "ent_Patriot"]
}
```

**Как это выглядит в правом верхнем контейнере (карточка):**

- Заголовок/аннотация, бейджи доменов с весами.
    
- Плитки метрик: **Importance 0.81**, **Novelty 0.37**, **Credibility 0.92** (иконка «i» раскрывает расчёт).
    
- «Почему важно»: drivers/implications.
    
- Сценарии с вероятностями и индикаторами (какие факты переключают сценарий).
    
- Кнопки: «Связанные сюжеты», «Карта акторов», «Экспорт».
    

---

#### **6.3.2. Связанные сущности (акторы)**

```json
[
  {"entity_id": "ent_US_Gov", "type": "state", "canonical_name": "Правительство США", "roles": ["issuer"]},
  {"entity_id": "ent_Ukraine", "type": "state", "canonical_name": "Украина", "roles": ["recipient"]},
  {"entity_id": "ent_EU", "type": "coalition", "canonical_name": "Европейский союз", "roles": ["issuer"]},
  {"entity_id": "ent_Patriot", "type": "project", "canonical_name": "Patriot (ПВО)", "roles": ["equipment"]}
]
```

**В карточке сюжета:** иконки акторов с ролями; клик по актору → мини‑досье (история участия, роли, связанные сюжеты).

---

#### **6.3.3. Таймлайн сюжета: факты (верх) и мнения (низ)**

**Факты:**

```json
[
  {
    "event_id": "evt_aid_2025_07_18",
    "type": "aid_package_announcement",
    "t_start": "2025-07-18T14:00:00Z",
    "location": {"geo": "Brussels, BE"},
    "actors": {"issuer":["ent_EU"], "recipient":["ent_Ukraine"]},
    "numerics": {"amount_eur": 1200000000, "includes_air_defense": true},
    "credibility": {"final": 0.89},
    "sources": ["src_eu_press_2025_07_18", "src_ft_2025_07_18"]
  },
  {
    "event_id": "evt_aid_2025_08_09",
    "type": "aid_package_announcement",
    "t_start": "2025-08-09T10:00:00Z",
    "location": {"geo": "Washington, DC"},
    "actors": {"issuer":["ent_US_Gov"], "recipient":["ent_Ukraine"]},
    "numerics": {"amount_usd": 2300000000, "includes_air_defense": true},
    "credibility": {"final": 0.90},
    "sources": ["src_whitehouse_2025_08_09", "src_reuters_2025_08_09"]
  },
  {
    "event_id": "evt_air_defense_delivery_2025_08_21",
    "type": "delivery",
    "t_start": "2025-08-21T08:30:00Z",
    "location": {"geo": "Rzeszów, PL"},
    "actors": {"issuer":["ent_US_Gov"], "recipient":["ent_Ukraine"]},
    "numerics": {"units": 2, "system": "Patriot"},
    "credibility": {"final": 0.82},
    "sources": ["src_pol_mo_2025_08_21"]
  }
]
```

**Мнения:**

```json
[
  {
    "position_id": "pos_ana_view_001",
    "about_type": "story",
    "about_id": "story_ukraine_aid_q3_2025",
    "by": "author_analyst_123",
    "role": "expert_comment",
    "modality": "opinion",
    "stance": "support",
    "text": "Пакет ЕС поможет закрыть дефицит ПВО к осени.",
    "posted_at": "2025-07-18T16:00:00Z",
    "opinion_score": {"final": 0.61}
  },
  {
    "position_id": "pos_media_view_002",
    "about_type": "event",
    "about_id": "evt_aid_2025_08_09",
    "by": "author_media_987",
    "role": "media_post",
    "modality": "opinion",
    "stance": "neutral",
    "text": "США делают акцент на ПВО и логистике.",
    "posted_at": "2025-08-09T12:15:00Z",
    "opinion_score": {"final": 0.52}
  },
  {
    "position_id": "pos_forecast_003",
    "about_type": "story",
    "about_id": "story_ukraine_aid_q3_2025",
    "by": "author_analyst_456",
    "role": "expert_comment",
    "modality": "forecast",
    "stance": "support",
    "text": "До конца квартала возможна поставка ещё 1–2 батарей ПВО.",
    "posted_at": "2025-08-20T09:00:00Z",
    "opinion_score": {"final": 0.57}
  }
]
```

**Как это выглядит в нижнем контейнере (таймлайн):**

- **Верх (факты):**  
    `● 18 Jul — EU: €1.2B` • `● 09 Aug — US: $2.3B` • `● 21 Aug — Delivery: 2×Patriot`  
    hover → мини‑карточка; click → полная карточка события справа.
    
- **Низ (мнения):**  
    `● 18 Jul — эксперт: «дефицит ПВО»` • `● 09 Aug — медиа: «акцент на ПВО»` • `● 20 Aug — прогноз: «+1–2 батареи»`  
    hover → мини; click → текст мнения справа, с `OpinionWeight` и источниками.
    

---

### **6.4. Взаимодействие в трёхконтейнерном UI (сценарий)**

1. **Левый верх (граф, сюжет‑центричный режим):** кликаем «Пакеты помощи Украине (Q3 2025)» →  
    правый верх заполняется карточкой сюжета; нижний таймлайн переключается на его события/мнения.
    
2. **Нижний таймлайн:** кликаем `09 Aug — US: $2.3B` →  
    справа открывается карточка события: источники, акторы, `FactCredibility=0.90` (кнопка «почему?» раскроет `base/cross_support/conflict`).
    
3. **Нижний таймлайн (мнение):** кликаем `20 Aug — прогноз` →  
    справа — текст, `OpinionWeight=0.57` с раскладкой `author/citation/fact_alignment`.
    
4. **Карточка сюжета:** кликаем актора `ent_Patriot` →  
    мини‑досье: где фигурирует, роли, связанные сюжеты; можно фильтровать таймлайн только по событиям с этим актором.
    
5. **Переключение вида в левом верхнем контейнере:** «Домен‑центричный» →  
    дерево `Безопасность → Война в Украине` подсвечивает активность ветки; наш сюжет — один из листьев.
    

---
## **7. Принципы формирования иерархии доменов и сюжетов**

---

### **7.1 Общая логика**

Система строится вокруг **двух центральных структур**:

1. **Иерархия доменов** — дерево тематических областей, внутри которых размещаются сюжеты.
    
2. **Сеть сюжетов** — динамическая, взаимосвязанная, изменчивая структура, которая связывает события, акторов, факты и мнения.
    

В идеале, домены дают **контекст и рамку**, а сюжеты — **историю и развитие событий**.

---

### **7.2 Иерархия доменов**

#### **7.2.1 Принцип построения**

- **Верхний уровень:**  
    Формируется **полуавтоматически**:
    
    - Система предлагает список основных направлений (на основе анализа массива данных, выделения ключевых NER, частоты словосочетаний, тематического моделирования).
        
    - Редактор подтверждает, удаляет или объединяет предложенные домены.
        
    - Возможна корректировка структуры вручную.
        
- **Нижние уровни:**  
    Формируются **автоматически**:
    
    - Кластеризация текстов внутри домена.
        
    - Автоматическое определение поддоменов по частоте упоминаний и тематической близости.
        
    - Возможность ручного редактирования в UI.
        

#### **7.2.2 Пример визуализации**

- **Граф / дерево:**
    
    - Верхние узлы — домены верхнего уровня.
        
    - Под ними — поддомены и связанные сюжеты.
        
    - Цвет узлов может отражать активность (интенсивность публикаций).
        
    - Размер узла — число сюжетов в домене.
        

---

### **7.3 Структура сюжетов**

#### **7.3.1 Принцип формирования**

- **Создание сюжета:**  
    Автоматическое объединение фактов и мнений, связанных по времени, месту, акторам и тематике.
    
- **Дополнение сюжета:**  
    При появлении новых публикаций, система:
    
    - Ищет совпадения по ключевым сущностям (NER).
        
    - Проверяет контекстную близость к существующим сюжетам.
        
    - При необходимости создаёт новый сюжет.
        
- **Редактор:**  
    Может объединять сюжеты, менять название, уточнять описание.
    

#### **7.3.2 Визуализация сюжетов**

- **В графе:** как узлы, соединённые с доменами и другими сюжетами.
    
- **В UI:** при выборе сюжета — карточка с описанием, метриками, актерами, связями и таймлайном.
    

---

### **7.4 Взаимосвязь доменов и сюжетов**

- Один сюжет может принадлежать **нескольким доменам**.
    
- Сюжет может **перемещаться** между доменами или менять вес принадлежности (если тематический фокус смещается).
    
- Домены дают _тематическую рамку_, сюжеты дают _временную и событийную структуру_.
    

---

### **7.5 Взаимодействие в UI**

- **Режим 1:** Исследование доменной карты (от общего к частному).
    
- **Режим 2:** Исследование сюжетов как динамических объектов (по аналогии с диском Пуанкаре, где активные сюжеты тянутся к центру).
    
- Переключение режимов — одна кнопка в панели инструментов.

## **8. Справочник сущностей системы**
Ниже приведено структурированное описание всех ключевых типов данных, с которыми будет работать система, включая их поля, связи и принципы извлечения.

---

### 8.1. **Домен** (Domain)

**Описание:**  
Тематическая категория верхнего или промежуточного уровня, объединяющая сюжеты по смыслу.  
Домен — это контейнер для сюжетов и поддоменов.  
Может принадлежать к более широкому домену (иерархия).

**Поля:**

- `id` — уникальный идентификатор.
    
- `name` — название домена (например, _"Военные конфликты"_).
    
- `parent_id` — идентификатор родительского домена (null для верхнего уровня).
    
- `description` — текстовое описание тематики.
    
- `relevance_score` — вычисленная метрика важности домена (на основе активности в сюжетах).
    
- `creation_type` — `"manual"`, `"auto"`, `"mixed"` — способ формирования.
    
- `created_at`, `updated_at`.
    

**Связи:**

- Один домен может иметь несколько поддоменов.
    
- Один сюжет может принадлежать к нескольким доменам.
    
- Домен агрегирует факты, мнения и акторов через сюжеты.
    

**Извлечение:**

- Верхний уровень — полуавтоматически: система предлагает темы, редактор подтверждает/корректирует.
    
- Поддомены — автоматически, через кластеризацию сюжетов по эмбеддингам.
    

---

### 8.2. **Сюжет** (Storyline)

**Описание:**  
Центральная единица аналитики. Группа связанных фактов, мнений и акторов, объединённых общей темой и развитием во времени.  
Сюжет — это «рассказ» о событии или цепочке событий.

**Поля:**

- `id` — уникальный идентификатор.
    
- `title` — краткое название (например, _"Контрнаступление на юге Украины"_).
    
- `summary` — обобщённое саммари по текущему состоянию сюжета.
    
- `domains` — список `id` доменов, к которым он относится.
    
- `actors` — список связанных акторов.
    
- `facts` — список связанных фактов.
    
- `opinions` — список связанных мнений.
    
- `importance_score` — важность сюжета (по активности и упоминаемости).
    
- `trend_score` — динамика популярности (растёт, падает, стабильно).
    
- `confidence_score` — агрегированная метрика достоверности (по фактам).
    
- `created_at`, `updated_at`.
    

**Связи:**

- Может принадлежать к нескольким доменам.
    
- Связан с актерами, фактами, мнениями, источниками.
    

**Извлечение:**

- Автоматическая кластеризация постов по смыслу (эмбеддинги + NER).
    
- Объединение с уже существующими сюжетами, если схожесть выше порога.
    
- Автоматическое обновление summary и связей при добавлении новых данных.
    

---

### 8.3. **Факт** (Fact)

**Описание:**  
Подтверждённое событие с конкретной датой и, возможно, местом, участниками и деталями.

**Поля:**

- `id` — уникальный идентификатор.
    
- `storyline_id` — id сюжета.
    
- `title` — краткое описание (например, _"Подписан мирный договор в Женеве"_).
    
- `description` — развёрнутое описание.
    
- `date_start`, `date_end` — начало и окончание (если применимо).
    
- `location` — место события (опционально, может быть NER-геометка).
    
- `actors` — список участников.
    
- `sources` — источники, упомянувшие факт.
    
- `confidence_score` — достоверность (0–1).
    
- `cross_references` — количество подтверждений из независимых источников.
    
- `created_at`, `updated_at`.
    

**Принципы отличия от мнения:**

- Факт имеет **несколько независимых источников**.
    
- Не содержит субъективных оценок.
    
- Достоверность можно измерить объективно.
    

---

### 8.4. **Мнение** (Opinion)

**Описание:**  
Субъективная оценка или комментарий по сюжету от конкретного автора.

**Поля:**

- `id` — уникальный идентификатор.
    
- `storyline_id` — id сюжета.
    
- `author_id` — автор мнения.
    
- `text` — текст мнения.
    
- `source` — источник публикации.
    
- `citations_count` — количество упоминаний/ссылок на это мнение.
    
- `trust_score` — доверие к автору (0–1, может задаваться редактором).
    
- `combined_score` — итоговая метрика значимости (учитывает цитируемость и доверие).
    
- `created_at`, `updated_at`.
    

**Принцип отличия от факта:**

- У мнения **один автор**.
    
- Может содержать субъективные выводы.
    
- Достоверность не абсолютная, но измеряется через доверие к автору.
    

---

### 8.5. **Актор** (Actor)

**Описание:**  
Действующее лицо или организация, участвующее в сюжете.

**Поля:**

- `id` — уникальный идентификатор.
    
- `name` — имя/название.
    
- `type` — `"person"`, `"organization"`, `"country"`, `"group"`.
    
- `description` — краткая справка.
    
- `trust_score` — доверие к этому актору как источнику.
    
- `related_storylines` — список сюжетов с участием актора.
    
- `created_at`, `updated_at`.
    

**Извлечение:**

- NER по именам и организациям.
    
- Сопоставление с базой известных акторов.
    

---

### 8.6. **Источник** (Source)

**Описание:**  
Платформа или издание, откуда пришли данные.

**Поля:**

- `id` — уникальный идентификатор.
    
- `name` — название издания или канала.
    
- `type` — `"media"`, `"social"`, `"blog"`.
    
- `trust_score` — доверие к источнику (может редактироваться вручную).
    
- `created_at`, `updated_at`.
    

---

### 8.7. **Автор** (Author)

**Описание:**  
Физическое или юридическое лицо, публикующее контент.

**Поля:**

- `id` — уникальный идентификатор.
    
- `name` — имя/псевдоним.
    
- `affiliation` — принадлежность (организация, СМИ).
    
- `trust_score` — доверие к автору.
    
- `created_at`, `updated_at`.

## **9. Пайплайн извлечения данных (end‑to‑end)
### 9.1 Обзор и архитектура потока

css

КопироватьРедактировать

`[ Источники ] → [Ingest] → [Нормализация] → [Дедупликация] → [NER+Linking]                                          → [Claim/Opinion Mining + Event Extraction]                                          → [Credibility/Weight]                                          → [Storyline Induction & Update]                                          → [Domain Assignment]                                          → [Graph & Timeline Update]                                          → [Материалы для UI/API]`

- Оркестрация: очередь задач (Celery/RQ) с **идемпотентностью** по `source_id` и `checksum`.
    
- Хранилище: PostgreSQL (+ pgvector); опционально графовый слой (Neo4j **или** edge‑таблицы в PG).
    
- Пересчёт метрик — **инкрементальный**, по затронутым объектам (event/story) + их «ауре» (связанные узлы).
    

---

### 9.2 Ingest и нормализация

**2.1. Приём контента**

- Каналы: RSS/API СМИ, Telegram/соцсети, официальные реестры (законы/бюллетени), файлы (PDF/пресс‑релизы).
    
- Фиксируем: `source_id`, `outlet_id`, `posted_at`, `url`, `lang?`, `raw_text`, `media_type`, `checksum(sha256)`.
    

**2.2. Нормализация текста**

- Детект языка (fastText/langid).
    
- Очистка от HTML/маркеров, извлечение основного текста (readability).
    
- Хранение **сырца** и нормализованной версии.
    

**2.3. Идемпотентность и ретраи**

- Ключ `url+checksum` → если уже есть, пропустить или обновить `posted_at`.
    
- Повторяемые ошибки — backoff; фатальные — помечаем `ingest_state=failed` с reason.
    

---

### 9.3 Дедупликация и «ложная независимость»

**3.1. Дедуп на уровне источника**

- SimHash/MinHash по нормализованному тексту.
    
- Шинглы 5–7 слов; порог схожести (напр., ≥0.9) → та же «новость».
    

**3.2. Репаблиш/репостинг**

- «Семейства» площадок (independence_group): `wire`, `official_gazette`, `major_media`, `local_media`, `blog`, `social`.
    
- Репост из того же кластера **не увеличивает** независимость (вклад «срезаем» на уровне групп при расчёте `base`).
    

---

### 9.4 NER, Linking, гео и время

**4.1. NER (RU/UA/EN multi)**

- Модели: spaCy/transformers; кастомные правила для транслитераций, склонений, стяжений.
    
- Типы: `PER/ORG/LOC/GPE/DATE/TIME/PRODUCT/LAW`.
    

**4.2. Linking**

- Канонизация: эмбеддинги + лексические правила → `entity_id`.
    
- Алиасы: сохраняем варианты написаний в `entity_aliases`.
    
- Внешние ID: `wikidata`, `isins`, `gov_id` — при наличии.
    

**4.3. Гео/темпоральная нормализация**

- Геокодинг LOC/GPE → координаты/адм.единицы.
    
- Dateparser для нормализации «вчера», «на прошлой неделе» → ISO.
    

---

### 9.5 Claim/Opinion Mining и Event Extraction

**5.1. Сегментация утверждений**

- Разбиваем текст на **кандидаты‑клеймы** (абзацы/предложения с триадами «кто‑что‑где/когда»).
    

**5.2. Классификация модальности и stance**

- `modality ∈ {fact, opinion, forecast}` (трансформер).
    
- `stance ∈ {support, oppose, neutral}` относительно `(story|event|entity)`, если мишень определяется.
    

**5.3. Event Extraction (slot filling)**

- Тип события (`event.type` из онтологии: релиз/закон/встреча/атака/сделка/санкции/поставка/утечка/арест/приговор/…).
    
- Поля: `t_start/t_end`, `location`, `actors{role→entity}`, `numerics{key→value}`.
    
- Версионирование: если клейм частично уточняет существующее событие → `version_of`.
    

**5.4. Привязка источника**

- Каждый `claim` → как минимум один `source_id`.
    
- Для медиа‑постов без первоисточника — `outlet_id` + `author_id?`.
    

---

### 9.6 Достоверность факта и вес мнения (онлайн‑оценка)

**6.1. Trust площадок/авторов**

- `trust_effective = clip(α*trust_base + (1-α)*trust_auto)` (α≈0.6–0.8).
    
- `trust_base` редактирует редактор (prior), `trust_auto` ведёт система (точность/опровержения).
    

**6.2. FactCredibility (итог)**

- Группируем подтверждения по `independence_group`.
    
- group_scoreg=1−∏i∈g(1−wi),base=1−∏g(1−group_scoreg)\text{group\_score}_g = 1 - \prod_{i\in g}(1-w_i),\quad \text{base} = 1 - \prod_g(1-\text{group\_score}_g)group_scoreg​=1−i∈g∏​(1−wi​),base=1−g∏​(1−group_scoreg​)
    
    где wiw_iwi​ — вес подтверждения (смесь trust outlet/author).
    
- Перекрёстная поддержка мнениями (малый вклад) + штраф конфликтам.
    
- `final = clip((base*penalty) + λ*cross_support, 0, 1)`.
    

**6.3. OpinionWeight (итог)**

- Автор/площадка AAA, цитируемость CCC (только **независимые**), согласованность с подтверждёнными фактами FFF.
    
- `final = clip(0.5A + 0.3C + 0.2F, 0, 1)`; decay для C (T½ = 30–60д).
    

> Обе метрики пишем в объект (`event.credibility`, `position.opinion_score`) с разложением по компонентам для UI‑объяснений.

---

### 9.7 Индукция сюжета, обновления и операции merge/split

**7.1. Появление «семени» сюжета**

- Новый `event` → матч к существующим сюжетам по:  
    (a) окну времени, (b) общим ключевым `entities`, (c) cosine(эмбеддинги) ≥ порога.
    
- Нет совпадений → создаётся `Storyline` (seed = этот event).
    

**7.2. Обновление сюжета**

- Прикрепление события/мнения:
    
    - обновить `timespan` (min/max t),
        
    - пересчитать `centroid_vec` (эмбеддинги событий+ключевых токенов),
        
    - обновить `centroid_entities` (частотные акторы с ролями),
        
    - пересчитать метрики: `importance`, `novelty_today`, `credibility`.
        
- Записать **дифф**: что именно изменилось (для блока «Что нового сегодня»).
    

**7.3. Merge/Split**

- **Merge**: высокое сходство центроидов + общие акторы + перекрытие таймлайнов → слияние; фиксируем `merged_from[]`, переносим связи/события/мнения, сохраняем redirect ID.
    
- **Split**: возрастание энтропии акторов/тем → HDBSCAN внутри сюжета выявляет под‑кластеры → создаём дочерние сюжеты, фиксируем `split_from`.
    

**7.4. Связи сюжетов**

- `related_to`, `continues`, `substory_of` с `strength` (сходство/общие акторы/темп активности).
    

---

### 9.8 Приписка к доменам (soft assignment)

**8.1. Автомат**

- Рассчитываем близость `story.centroid_vec` к **узлам‑прототипам** доменов (L0–L3).
    
- Нормируем в веса: максимум N доменов (например, N=3), чтобы избежать распыления.
    

**8.2. Редакторская коррекция**

- Закрепление (`pin`) домена, ограничение «размазывания» (top‑K only), ручная правка весов.
    
- Отметка статуса: `●` ручной, `⟲` авто, `✔` авто‑подтверждён.
    

---

### 9.9 Обновление графа и таймлайна

**9.1. Граф**

- Узлы: Story/Event/Entity; рёбра: участия, ссылок, семантической близости.
    
- Веса рёбер: сила связи (частота совместных упоминаний, роль актора, вероятность принадлежности).
    
- Кэш для фронта: pre‑compute subgraph по активному сюжету (ego‑graph на k=2).
    

**9.2. Таймлайн**

- Верх — факты (по `t_start`); низ — мнения (по `posted_at`).
    
- Фильтры: `type`, `modality`, `stance`, `author/outlet`, `credibility/opinion_weight`.
    
- Снэпшоты на день/неделю для быстрой прокрутки.
    

---

### 9.10 Контроль качества, версии и повторная обработка

**10.1. Версионирование**

- `events.version_of`, `positions.revisions?` — сохраняем линейку изменений.
    
- Источники опровержений → отрицательные клеймы, уменьшают `FactCredibility`.
    

**10.2. Backfill и reindex**

- При изменении `trust_base` у outlet/author → **каскадный пересчёт**: затронутые events → story metrics.
    
- Регулярный reindex эмбеддингов (модель обновилась → репроекция центроидов).
    

**10.3. Мониторинг**

- Метрики пайплайна: задержки, доля дедупов, precision/recall для NER/Events/Modality на эталонной выборке.
    
- Алерты: падение качества выше порога, рост конфликтов по сюжету.
    

---

### 9.11 Псевдокод: обработка одного поста

python

КопироватьРедактировать

`def process_post(source_meta, raw_text):     src = upsert_source(source_meta)                   # idempotent     if is_duplicate(raw_text, src): return          norm_text = normalize(raw_text)     lang = detect_lang(norm_text)          ents = ner_and_link(norm_text, lang)     claims = segment_and_classify(norm_text, lang)     # modality, stance          events, opinions = [], []     for cl in claims:         if cl.modality == 'fact':             evt = match_or_create_event(cl, ents)             evt = upsert_event_fields(evt, cl)             attach_source(evt, src)             recompute_fact_credibility(evt)             events.append(evt)         else:             pos = make_position(cl, src)             recompute_opinion_weight(pos)             opinions.append(pos)          affected_stories = set()     for evt in events:         stories = match_storylines_by_event(evt)         if not stories:             s = create_story_from_seed(evt)             stories = [s]         for s in stories:             attach_event_to_story(s, evt)             affected_stories.add(s)          for pos in opinions:         # если opinion «про сюжет», привяжем сразу         if pos.about_type == 'story':             attach_position_to_story(pos.about_id, pos)             affected_stories.add(pos.about_id)          for s in affected_stories:         recompute_story_metrics(s)      # importance, novelty_today, credibility         reassign_domains(s)             # soft assignment + editor pins respected         update_story_graph_caches(s)    # ego-subgraph for UI`

---

### 9.12 Хранилище и индексы (минимум)

- **PostgreSQL**:
    
    - `storylines(centroid_vec VECTOR, updated_at)` — ivfflat index (cosine).
        
    - `events(centroid_vec VECTOR, t_start)` — ivfflat + btree по времени.
        
    - `positions(embedding VECTOR, posted_at)` — ivfflat для похожих мнений.
        
    - Junction‑таблицы: `story_events`, `event_entities`, `story_domains`.
        
- **Ключи идемпотентности**: `(url, checksum)` в `sources`; `(source_id, sentence_hash)` для клеймов (опционально).
    

---

### 9.13 Языки и мультимодальность

- Языки: RU/UA/EN минимум; расширение через мультиязычную модель эмбеддингов (Sentence‑BERT / LaBSE).
    
- PDF/сканы: OCR (Tesseract/PaddleOCR) → дальше обычный пайплайн.
    
- Видео/аудио: ASR (Whisper) → текст → тот же пайплайн (помечаем `media_type`).
    

---

### 9.14 Политика пересчётов и SLA

- Триггеры пересчёта: новый event/position; изменение trust; merge/split.
    
- Лимиты: **батч‑пересчёт ночью**, «горячий» инкремент — в реальном времени для активных сюжетов.
    
- SLA UI: 95‑й перцентиль ответа API ≤ 300–500 мс (кэш + предвычисленные срезы).