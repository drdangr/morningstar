#!/usr/bin/env python3
"""
–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ N8N workflow —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Ç–µ–º–∞–º–∏
"""

import json
import requests

# –¢–µ—Å—Ç–æ–≤—ã–µ –ø–æ—Å—Ç—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º —Ç–µ–º–∞–º
test_posts = [
    {
        "id": "test1",
        "text": "OpenAI –≤—ã–ø—É—Å—Ç–∏–ª–∞ –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é GPT-5 —Å —É–ª—É—á—à–µ–Ω–Ω—ã–º–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º–∏ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è",
        "channel": "tech_news",
        "views": 1500
    },
    {
        "id": "test2", 
        "text": "–í –¢—É–ª–µ –æ—Ç–∫—Ä—ã–ª—Å—è –Ω–æ–≤—ã–π IT-–ø–∞—Ä–∫ –¥–ª—è —Å—Ç–∞—Ä—Ç–∞–ø–æ–≤ –∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –∫–æ–º–ø–∞–Ω–∏–π",
        "channel": "tula_news",
        "views": 800
    },
    {
        "id": "test3",
        "text": "–°–±–æ—Ä–Ω–∞—è –†–æ—Å—Å–∏–∏ –ø–æ —Ñ—É—Ç–±–æ–ª—É –ø–æ–±–µ–¥–∏–ª–∞ –ë—Ä–∞–∑–∏–ª–∏—é —Å–æ —Å—á–µ—Ç–æ–º 3:1 –≤ —Ç–æ–≤–∞—Ä–∏—â–µ—Å–∫–æ–º –º–∞—Ç—á–µ",
        "channel": "sport_news", 
        "views": 2200
    },
    {
        "id": "test4",
        "text": "–ù–æ–≤—ã–π —Ä–µ—Å—Ç–æ—Ä–∞–Ω McDonald's –æ—Ç–∫—Ä—ã–ª—Å—è –≤ —Ü–µ–Ω—Ç—Ä–µ –ù—å—é-–ô–æ—Ä–∫–∞",
        "channel": "world_news",
        "views": 300
    },
    {
        "id": "test5",
        "text": "–¢—É–ª—å—Å–∫–∏–π –æ—Ä—É–∂–µ–π–Ω—ã–π –∑–∞–≤–æ–¥ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏–ª –Ω–æ–≤—É—é –º–æ–¥–µ–ª—å —Å–ø–æ—Ä—Ç–∏–≤–Ω–æ–≥–æ –∫–∞—Ä–∞–±–∏–Ω–∞",
        "channel": "tula_industry",
        "views": 650
    },
    {
        "id": "test6",
        "text": "Tesla –∞–Ω–æ–Ω—Å–∏—Ä–æ–≤–∞–ª–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–Ω–æ–º–Ω—ã–µ —Ä–æ–±–æ—Ç–∞–∫—Å–∏ –Ω–∞ –±–∞–∑–µ –ò–ò",
        "channel": "auto_tech",
        "views": 1800
    }
]

# –ò–º–∏—Ç–∞—Ü–∏—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤ —Å —Ä–∞–∑–Ω—ã–º–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏
channels_metadata = {
    "tech_news": {
        "categories": [
            {"name": "–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏", "is_active": True, "ai_prompt": "–Ω–æ–≤–æ—Å—Ç–∏ –æ IT, –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–º –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–µ, —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ"}
        ]
    },
    "tula_news": {
        "categories": [
            {"name": "–¢—É–ª–∞", "is_active": True, "ai_prompt": "–Ω–æ–≤–æ—Å—Ç–∏ –≤ –∫–æ—Ç–æ—Ä—ã—Ö —É–ø–æ–º–∏–Ω–∞–µ—Ç—Å—è –¢—É–ª—å—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å –∏–ª–∏ –¢—É–ª–∞"},
            {"name": "–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏", "is_active": True, "ai_prompt": "–Ω–æ–≤–æ—Å—Ç–∏ –æ IT, –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–º –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–µ, —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ"}
        ]
    },
    "sport_news": {
        "categories": [
            {"name": "–°–ø–æ—Ä—Ç", "is_active": True, "ai_prompt": "—Å–ø–æ—Ä—Ç–∏–≤–Ω—ã–µ –Ω–æ–≤–æ—Å—Ç–∏ –∏ —Å–æ–±—ã—Ç–∏—è"}
        ]
    },
    "world_news": {
        "categories": []
    },
    "tula_industry": {
        "categories": [
            {"name": "–¢—É–ª–∞", "is_active": True, "ai_prompt": "–Ω–æ–≤–æ—Å—Ç–∏ –≤ –∫–æ—Ç–æ—Ä—ã—Ö —É–ø–æ–º–∏–Ω–∞–µ—Ç—Å—è –¢—É–ª—å—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å –∏–ª–∏ –¢—É–ª–∞"}
        ]
    },
    "auto_tech": {
        "categories": [
            {"name": "–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏", "is_active": True, "ai_prompt": "–Ω–æ–≤–æ—Å—Ç–∏ –æ IT, –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–º –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–µ, —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ"}
        ]
    }
}

# –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ N8N webhook
webhook_data = {
    "posts": test_posts,
    "channels_metadata": channels_metadata,
    "collection_stats": {
        "total_posts": len(test_posts),
        "channels_count": len(channels_metadata),
        "collection_time": "2025-12-08T15:30:00Z"
    }
}

def test_workflow():
    """–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ workflow —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Ç–µ–º–∞–º–∏"""
    
    print("üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ N8N workflow —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Ç–µ–º–∞–º–∏...")
    print(f"üìä –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ: {len(test_posts)} –ø–æ—Å—Ç–æ–≤, {len(channels_metadata)} –∫–∞–Ω–∞–ª–æ–≤")
    
    # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–∞–∫–∏–µ —Ç–µ–º—ã –±—É–¥—É—Ç –≤ –ø—Ä–æ–º–ø—Ç–µ
    all_categories = set()
    for channel_meta in channels_metadata.values():
        for cat in channel_meta.get("categories", []):
            if cat.get("is_active"):
                all_categories.add(f"{cat['name']} ({cat['ai_prompt']})")
    
    print("\nüéØ –û–∂–∏–¥–∞–µ–º—ã–µ —Ç–µ–º—ã –≤ –ø—Ä–æ–º–ø—Ç–µ:")
    for topic in sorted(all_categories):
        print(f"  ‚Ä¢ {topic}")
    
    print("\nüìù –¢–µ—Å—Ç–æ–≤—ã–µ –ø–æ—Å—Ç—ã:")
    for post in test_posts:
        print(f"  {post['id']}: {post['text'][:60]}...")
    
    # –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
    print("\nüí≠ –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞:")
    print("  test1 (OpenAI GPT-5) ‚Üí –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ ‚úÖ")
    print("  test2 (IT-–ø–∞—Ä–∫ –≤ –¢—É–ª–µ) ‚Üí –¢—É–ª–∞ ‚úÖ + –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ ‚úÖ") 
    print("  test3 (—Ñ—É—Ç–±–æ–ª –†–æ—Å—Å–∏—è-–ë—Ä–∞–∑–∏–ª–∏—è) ‚Üí –°–ø–æ—Ä—Ç ‚úÖ")
    print("  test4 (McDonald's –≤ –ù—å—é-–ô–æ—Ä–∫–µ) ‚Üí NULL ‚ùå")
    print("  test5 (–¢—É–ª—å—Å–∫–∏–π –æ—Ä—É–∂–µ–π–Ω—ã–π –∑–∞–≤–æ–¥) ‚Üí –¢—É–ª–∞ ‚úÖ")
    print("  test6 (Tesla —Ä–æ–±–æ—Ç–∞–∫—Å–∏) ‚Üí –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ ‚úÖ")
    
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ä—É—á–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏
    with open("test_multiple_topics_data.json", "w", encoding="utf-8") as f:
        json.dump(webhook_data, f, ensure_ascii=False, indent=2)
    
    print(f"\nüíæ –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ test_multiple_topics_data.json")
    print("üöÄ –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç–ø—Ä–∞–≤—å—Ç–µ —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ –Ω–∞ N8N webhook:")
    print("   POST http://localhost:5678/webhook/telegram-posts")
    
    return webhook_data

if __name__ == "__main__":
    test_workflow() 